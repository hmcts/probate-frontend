<script src="/public/javascripts/jquery-1.11.3.js"></script>

<!-- govuk_frontend_toolkit js -->
<script src="/public/javascripts/vendor/polyfills/bind.js"></script>
<script src="/public/javascripts/govuk/details.polyfill.js"></script>
<script src="/public/javascripts/govuk/shim-links-with-button-role.js"></script>
<script src="/public/javascripts/govuk/show-hide-content.js"></script>

<script src="/public/javascripts/application.js"></script>

{% if enableTracking === 'true' %}
    <script nonce="{{ nonce }}">
        var gatrackingid = "{{ gaTrackingId }}";
    </script>
    <script src="/public/javascripts/ga-tracking.js"></script>
{% endif %}

<script src="/public/javascripts/dropzone.js"></script>
<script nonce="{{ nonce }}">
    var documentUploadConfig = {
        csrfToken: '{{ csrfToken }}',
        validMimeTypes: '{{ documentUpload.validMimeTypes }}',
        maxFiles: '{{ documentUpload.maxFiles }}',
        maxSizeBytes: '{{ documentUpload.maxSizeBytes }}',
        timeout: '{{ documentUpload.timeout }}',
        content: {
            removeFileText: '{{ common.documentUploadRemoveFile }}',
            errorSummaryHeading: '{{ common.errorSummaryHeading }}',
            invalidFileType: '{{ common['documentUpload-invalidFileType'] }}',
            invalidFileTypeSummary: '{{ common['documentUpload-invalidFileTypeSummary'] }}',
            maxFiles: '{{ common['documentUpload-maxFiles'] }}',
            maxFilesSummary: '{{ common['documentUpload-maxFilesSummary'] }}',
            maxSize: '{{ common['documentUpload-maxSize'] }}',
            maxSizeSummary: '{{ common['documentUpload-maxSizeSummary'] }}',
            uploadFailed: '{{ common['documentUpload-uploadFailed'] }}',
            uploadFailedSummary: '{{ common['documentUpload-uploadFailedSummary'] }}',
            uploadTimeout: '{{ common['documentUpload-uploadTimeout'] }}',
            uploadTimeoutSummary: '{{ common['documentUpload-uploadTimeoutSummary'] }}'
        }
    };
</script>
<script src="/public/javascripts/document-upload.js"></script>

<!--[if lte IE 9]>
<script src="/public/javascripts/form-polyfill.js"></script>
<![endif]-->

<script scr="http://vcc-eu4.8x8.com/" nonce="{{ nonce }}">
    window.__8x8Chat = {
        uuid: 'script_4860291385c640afb2487b9.55856720',
        tenant: 'aG1jdHNzdGFnaW5nMDE',
        channel: 'Probate_Demo',
        domain: 'https://vcc-eu4.8x8.com',
        path: '/.',
        buttonContainerId: '__8x8-chat-button-container-script_4860291385c640afb2487b9-55856720',
        align: 'right',
        stylesheetURL: 'https://cdn.jsdelivr.net/gh/hmcts/ctsc-web-chat/hmcts-webchat.css',
        linkText: '{{ common.chatOnlineWithAnAgent }}',
        additionalText: '{{ common.chatOnlineOpeningHours }}',
        onInit: function(bus) {
            window.bus = bus;
            bus.publish('customer:set-info', {
                'Logged In Id': 'Not logged in',
                'Case Id': 'Not available'
            });

            const chatContainer = document.querySelector(`#${window.__8x8Chat.buttonContainerId}`);
            const callback = () => {
                const chatImg = document.querySelector(`#${window.__8x8Chat.buttonContainerId} img`);

                if (chatImg) {
                    const chatContainer = document.querySelector(`#${window.__8x8Chat.buttonContainerId}`);
                    const chatLink = document.querySelector(`#${window.__8x8Chat.buttonContainerId} a`);

                    const br = document.createElement('br');
                    const additionalText = document.createTextNode(window.__8x8Chat.additionalText);

                    chatLink.innerHTML = null;
                    chatLink.innerText = window.__8x8Chat.linkText;

                    chatContainer.appendChild(br);
                    chatContainer.appendChild(additionalText);
                }
            };

            callback();

            var mutationObserver = new MutationObserver(callback);
            mutationObserver.observe(chatContainer, {
                childList: true,
            });
        }
    };

    (function() {
        const se = document.createElement('script');
        se.type = 'text/javascript';
        se.async = true;
        se.src = `${window.__8x8Chat.domain}${window.__8x8Chat.path}/CHAT/common/js/chat.js`;

        const os = document.getElementsByTagName('script')[0];
        os.parentNode.insertBefore(se, os);
    })();
</script>
